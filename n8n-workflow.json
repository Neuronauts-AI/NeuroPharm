{
  "name": "Drug Interaction Analysis",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "drug-analysis",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "functionCode": "// Ä°laÃ§ etkileÅŸimlerini analiz et\nconst currentMeds = $json.currentMedications || [];\nconst newMeds = $json.newMedications || [];\nconst conditions = $json.conditions || [];\n\n// Ä°laÃ§ adlarÄ±nÄ± topla\nconst allMedicines = [\n  ...currentMeds.map(m => m.name.toLowerCase()),\n  ...newMeds.map(m => m.name.toLowerCase())\n];\n\n// Risk skorunu hesapla\nlet riskScore = 0;\n\n// Bilinen riskli kombinasyonlar\nconst riskyInteractions = {\n  'aspirin+ibuprofen': { risk: 85, message: 'Mide kanamasÄ± riski yÃ¼ksek' },\n  'warfarin+aspirin': { risk: 90, message: 'Kanama riski Ã§ok yÃ¼ksek' },\n  'metformin+alkol': { risk: 70, message: 'Laktik asidoz riski' },\n  'simvastatin+amlodipine': { risk: 60, message: 'Kas hasarÄ± riski artabilir' }\n};\n\n// EtkileÅŸim kontrolÃ¼\nfor (let i = 0; i < allMedicines.length; i++) {\n  for (let j = i + 1; j < allMedicines.length; j++) {\n    const combo = `${allMedicines[i]}+${allMedicines[j]}`;\n    const reverseCombo = `${allMedicines[j]}+${allMedicines[i]}`;\n    \n    if (riskyInteractions[combo]) {\n      riskScore = Math.max(riskScore, riskyInteractions[combo].risk);\n    } else if (riskyInteractions[reverseCombo]) {\n      riskScore = Math.max(riskScore, riskyInteractions[reverseCombo].risk);\n    }\n  }\n}\n\n// HastalÄ±k ve ilaÃ§ sayÄ±sÄ±na gÃ¶re ek risk\nif (riskScore === 0) {\n  riskScore = Math.min(20 + (conditions.length * 5) + (allMedicines.length * 3), 100);\n}\n\n// Alternatif Ã¶neriler\nlet alternatives = \"\";\nif (allMedicines.includes('aspirin') && allMedicines.includes('ibuprofen')) {\n  alternatives = \"Aspirin ve Ibuprofen kombinasyonu yerine:\\n- Paracetamol (aÄŸrÄ± iÃ§in)\\n- Aspirin'i tek baÅŸÄ±na kullanÄ±n\\n- Gastro-koruyucu ilaÃ§ ekleyin\";\n} else if (allMedicines.includes('warfarin')) {\n  alternatives = \"Warfarin kullanÄ±yorsanÄ±z:\\n- DÃ¼zenli INR takibi yapÄ±n\\n- YeÅŸil yapraklÄ± sebzeleri dengeli tÃ¼ketin\\n- Yeni ilaÃ§ eklerken doktorunuza danÄ±ÅŸÄ±n\";\n} else if (riskScore >= 40) {\n  alternatives = \"Ä°laÃ§ kombinasyonunuz izleme gerektirir. Alternatif Ã¶neriler iÃ§in hekiminize danÄ±ÅŸÄ±n.\";\n} else {\n  alternatives = \"Mevcut ilaÃ§ kombinasyonu uygun gÃ¶rÃ¼nmektedir.\";\n}\n\n// AÃ§Ä±klama\nconst newMedsList = newMeds.map(m => m.name).join(', ');\nconst currentMedsList = currentMeds.map(m => m.name).join(', ');\nconst conditionsList = conditions.join(', ');\n\nlet explanation = `Ä°laÃ§ EtkileÅŸim Analiz Raporu\\n\\n`;\nexplanation += `ğŸ“Š Genel Bilgiler:\\n`;\nexplanation += `- Hasta hastalÄ±klarÄ±: ${conditionsList || 'BelirtilmemiÅŸ'}\\n`;\nexplanation += `- Mevcut ilaÃ§lar (${currentMeds.length}): ${currentMedsList || 'Yok'}\\n`;\nexplanation += `- Yeni eklenen ilaÃ§lar (${newMeds.length}): ${newMedsList}\\n\\n`;\n\nexplanation += `âš ï¸ Risk DeÄŸerlendirmesi:\\n`;\nif (riskScore >= 70) {\n  explanation += `YÃœKSEK RÄ°SK tespit edildi (${riskScore}/100)\\n`;\n  explanation += `Bu ilaÃ§ kombinasyonu ciddi yan etkilere yol aÃ§abilir.\\n`;\n  explanation += `Mutlaka hekiminizle gÃ¶rÃ¼ÅŸÃ¼n ve onay alÄ±n.\\n`;\n} else if (riskScore >= 40) {\n  explanation += `ORTA RÄ°SK tespit edildi (${riskScore}/100)\\n`;\n  explanation += `Bu ilaÃ§ kombinasyonu izleme gerektirir.\\n`;\n  explanation += `Yan etkilere dikkat edin ve dÃ¼zenli kontrol yaptÄ±rÄ±n.\\n`;\n} else {\n  explanation += `DÃœÅÃœK RÄ°SK tespit edildi (${riskScore}/100)\\n`;\n  explanation += `Ä°laÃ§ kombinasyonu genel olarak gÃ¼venli gÃ¶rÃ¼nmektedir.\\n`;\n  explanation += `Normal kullanÄ±m talimatlarÄ±na uyun.\\n`;\n}\n\nexplanation += `\\nğŸ’Š Ã–neriler:\\n`;\nexplanation += `- Ä°laÃ§larÄ± dÃ¼zenli saatlerde alÄ±n\\n`;\nexplanation += `- Yan etki gÃ¶zlemlerseniz doktorunuza bildirin\\n`;\nexplanation += `- Ä°laÃ§ dozlarÄ±nÄ± kendiniz deÄŸiÅŸtirmeyin\\n`;\n\nif (conditions.includes('Diyabet') || conditions.includes('Hipertansiyon')) {\n  explanation += `- Kronik hastalÄ±ÄŸÄ±nÄ±z iÃ§in dÃ¼zenli kontrol Ã¶nemlidir\\n`;\n}\n\n// Response\nreturn {\n  riskScore: riskScore,\n  alternativeMedicines: alternatives,\n  explanation: explanation\n};"
      },
      "name": "Analyze Drug Interactions",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [650, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Analyze Drug Interactions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Drug Interactions": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
